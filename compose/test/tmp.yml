version: "3.8"

services:
  
  api:
    build:
      context: ../../api
    command: /app/scripts/start_api_with_test_fixture
    networks:
      - cfo
    
  web:
    build:
      context: ../../web
      dockerfile: Dockerfile.test
    command: yarn serve
    ports:
      - "8080:8080"
    networks:
      - cfo
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080"]
      interval: 30s
      timeout: 10s
      retries: 5
    environment:
      - VUE_APP_BASE_API=http://api:3000
    depends_on:
      - api
  
  e2e:
    build:
      context: ../../e2e
    command: npx playwright test
    depends_on:
      web:
        condition: service_healthy
    networks:
      - cfo
    links:
      - web
      - api
networks:
  cfo:
    
  
